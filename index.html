<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário com OAuth - Google Sheets</title>
    <!-- Carrega a API do Google -->
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f4f4f4;
        }
        form {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            max-width: 400px;
            margin: auto;
        }
        input, button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        button {
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>

    <h2>Formulário com OAuth para Google Sheets</h2>

    <form id="form">
        <label for="nome">Nome:</label>
        <input type="text" id="nome" name="nome" required>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>

        <button type="submit">Enviar para Google Sheets</button>
    </form>

    <script>
        let CLIENT_ID = '19755273624-3qu7v5ultqo3oqc1o83ils1v4cg8go30.apps.googleusercontent.com'; // Substitua pelo seu Client ID
        let API_KEY = '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'; // Substitua pela sua Key
        let DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];
        let SCOPES = "https://www.googleapis.com/auth/spreadsheets";

        // Carrega a API e inicializa o cliente OAuth
        function handleClientLoad() {
            gapi.load('client:auth2', initClient);
        }

        // Inicializa o cliente e configura o OAuth 2.0
        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                discoveryDocs: DISCOVERY_DOCS,
                scope: SCOPES
            }).then(() => {
                gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

                // Verifica se o usuário já está logado
                updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());

                // Vincula o envio do formulário
                document.getElementById('form').addEventListener('submit', handleAuthClick);
            });
        }

        // Atualiza o status de login
        function updateSigninStatus(isSignedIn) {
            if (isSignedIn) {
                // Se estiver logado, adiciona a função de envio ao formulário
                document.getElementById('form').addEventListener('submit', sendToGoogleSheets);
            }
        }

        // Solicita login via OAuth 2.0
        function handleAuthClick(event) {
            event.preventDefault();
            gapi.auth2.getAuthInstance().signIn();
        }

        // Envia os dados para o Google Sheets
        function sendToGoogleSheets(event) {
            event.preventDefault();
            
            const nome = document.getElementById('nome').value;
            const email = document.getElementById('email').value;

            const values = [
                [nome, email]
            ];

            const params = {
                spreadsheetId: '1LNiJ70U5YgCem9-ju71M6_NDCfEoSt0PaN7FslviT68', // ID da planilha
                range: 'Sheet1!A:B', // Intervalo na planilha
                valueInputOption: 'USER_ENTERED'
            };

            const valueRangeBody = {
                "values": values
            };

            gapi.client.sheets.spreadsheets.values.append(params, valueRangeBody).then((response) => {
                console.log('Resposta do Google Sheets:', response);
                alert('Dados enviados com sucesso para o Google Sheets!');
            }, (err) => {
                console.error('Erro ao enviar para o Google Sheets:', err);
                alert('Erro ao enviar para o Google Sheets: ' + JSON.stringify(err));
            });
        }

        // Carrega a biblioteca API do Google e inicializa o cliente OAuth
        handleClientLoad();
    </script>

</body>
</html>
